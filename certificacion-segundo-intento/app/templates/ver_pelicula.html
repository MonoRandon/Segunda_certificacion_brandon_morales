<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>{{ pelicula.titulo }} - Cinepedia</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="container">
    <h1>{{ pelicula.titulo }}</h1>
    <p>Director: {{ pelicula.director }}</p>
    <p>Fecha: {{ pelicula.fecha }}</p>
    <p>Sinopsis: {{ pelicula.sinopsis }}</p>

    <a href="{{ url_for('peliculas.dashboard') }}">Volver al Dashboard</a>

    <h2>Comentarios</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if pelicula.es_creador %}
      <p>No puedes comentar tu propia película.</p>
    {% else %}
      <form action="{{ url_for('comentario_bp.comentar', pelicula_id=pelicula.id) }}" method="POST">
        <textarea name="contenido" placeholder="Escribe tu comentario..." required></textarea>
        <button type="submit">Agregar Comentario</button>
      </form>
    {% endif %}

    {% if comentarios %}
      <ul>
        {% for comentario in comentarios %}
          <li>
            <strong>{{ comentario.usuario_nombre }} {{ comentario.usuario_apellido }}</strong>
            <small> - {{ comentario.fecha_creacion }}</small>
            <p>{{ comentario.contenido }}</p>

            {% if comentario.usuario_id == session.get('user_id') %}
              <form action="{{ url_for('comentario_bp.eliminar_comentario', comentario_id=comentario.id) }}" method="POST" style="display:inline;">
                <button type="submit">Eliminar</button>
              </form>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No hay comentarios aún.</p>
    {% endif %}
  </div>
</body>
</html>
